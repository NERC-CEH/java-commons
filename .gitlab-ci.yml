mirror:
  stage: build
  image: buildpack-deps:xenial-scm
  script:
    - git push -q --prune https://$GITHUB_USERNAME:$GITHUB_PASSWORD@github.com/NERC-CEH/java-commons.git +refs/remotes/origin/*:refs/heads/* +refs/tags/*:refs/tags/*

build:
  stage: build
  image: maven:3.2-jdk-7
  script: 
    - mvn clean install

deploy:
  stage: deploy
  image: maven:3.2-jdk-7
  script:
    - mkdir /root/.gnupg
    - base64 -d <<< $SECRING_GPG_64 > /root/.gnupg/secring.gpg
    - base64 -d <<< $PUBRING_GPG_64 > /root/.gnupg/pubring.gpg
    - echo "$SETTINGS_XML" > /root/.m2/settings.xml
    - mvn release:prepare release:perform -B -Dusername=$GITLAB_USERNAME -Dpassword=$GITLAB_PASSWORD -Dgpg.passphrase=$GPG_PASS
  when: manual
